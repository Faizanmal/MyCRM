apiVersion: v1
kind: ConfigMap
metadata:
  name: backend-config
  namespace: mycrm
data:
  DJANGO_SETTINGS_MODULE: "backend.settings_production"
  DEBUG: "false"
  ALLOWED_HOSTS: "api.mycrm.com,*.mycrm.com"
  CORS_ALLOWED_ORIGINS: "https://mycrm.com,https://www.mycrm.com,https://app.mycrm.com"
  
  # Database
  DB_ENGINE: "django.db.backends.postgresql"
  DB_HOST: "postgres-primary"
  DB_PORT: "5432"
  DB_NAME: "mycrm"
  DB_READ_HOST: "postgres-read"
  
  # Redis
  REDIS_URL: "redis://redis-master:6379/0"
  CACHE_REDIS_URL: "redis://redis-master:6379/1"
  
  # Celery
  CELERY_BROKER_URL: "redis://redis-master:6379/2"
  CELERY_RESULT_BACKEND: "redis://redis-master:6379/3"
  
  # OpenTelemetry
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://jaeger-collector:4317"
  OTEL_SERVICE_NAME: "mycrm-backend"
  OTEL_TRACES_SAMPLER: "parentbased_traceidratio"
  OTEL_TRACES_SAMPLER_ARG: "0.1"
  
  # Feature Flags
  ENABLE_ENTERPRISE_FEATURES: "true"
  ENABLE_AI_FEATURES: "true"
  ENABLE_ZERO_TRUST: "true"
  
  # Logging
  LOG_LEVEL: "INFO"
  LOG_FORMAT: "json"
  
  # Security
  SECURE_SSL_REDIRECT: "true"
  SESSION_COOKIE_SECURE: "true"
  CSRF_COOKIE_SECURE: "true"
  SECURE_HSTS_SECONDS: "31536000"
  SECURE_HSTS_INCLUDE_SUBDOMAINS: "true"
  SECURE_HSTS_PRELOAD: "true"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: frontend-config
  namespace: mycrm
data:
  NEXT_PUBLIC_API_URL: "https://api.mycrm.com"
  NEXT_PUBLIC_WS_URL: "wss://api.mycrm.com/ws"
  NEXT_PUBLIC_APP_NAME: "MyCRM"
  NEXT_PUBLIC_SENTRY_DSN: ""
  NEXT_PUBLIC_ANALYTICS_ID: ""
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
  namespace: mycrm
data:
  POSTGRES_DB: "mycrm"
  POSTGRES_MAX_CONNECTIONS: "200"
  POSTGRES_SHARED_BUFFERS: "2GB"
  POSTGRES_EFFECTIVE_CACHE_SIZE: "6GB"
  POSTGRES_MAINTENANCE_WORK_MEM: "512MB"
  POSTGRES_CHECKPOINT_COMPLETION_TARGET: "0.9"
  POSTGRES_WAL_BUFFERS: "64MB"
  POSTGRES_DEFAULT_STATISTICS_TARGET: "100"
  POSTGRES_RANDOM_PAGE_COST: "1.1"
  POSTGRES_EFFECTIVE_IO_CONCURRENCY: "200"
  POSTGRES_MIN_WAL_SIZE: "1GB"
  POSTGRES_MAX_WAL_SIZE: "4GB"
  POSTGRES_MAX_WORKER_PROCESSES: "4"
  POSTGRES_MAX_PARALLEL_WORKERS_PER_GATHER: "2"
  POSTGRES_MAX_PARALLEL_WORKERS: "4"
  POSTGRES_MAX_PARALLEL_MAINTENANCE_WORKERS: "2"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
  namespace: mycrm
data:
  redis.conf: |
    maxmemory 2gb
    maxmemory-policy allkeys-lru
    appendonly yes
    appendfsync everysec
    tcp-keepalive 300
    timeout 0
    tcp-backlog 511
    bind 0.0.0.0
    protected-mode no
    
    # Cluster mode settings
    cluster-enabled yes
    cluster-config-file nodes.conf
    cluster-node-timeout 5000
    
    # Persistence
    save 900 1
    save 300 10
    save 60 10000
    
    # Security
    rename-command FLUSHDB ""
    rename-command FLUSHALL ""
    rename-command DEBUG ""
    rename-command CONFIG ""
